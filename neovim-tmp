""" Overall Configuration ----------
set tabstop=4
set shiftwidth=4
set expandtab

set number
set mouse=a
"set scrolloff=5
set termguicolors

set inccommand=split
set clipboard=unnamed
set completeopt=longest,menuone,noselect

set background=dark
set t_Co=256

set autoread " Automatically update file if changed outside of Vim 
set autowrite " Automaically save file when swap between opened files

set nobackup
"set backupdir=~/.cache/nvim/backups
set noswapfile
"set directory=~/.cache/nvim/swapfiles
"set noundofile
set undodir=~/.cache/nvim/undofiles

""" Key Bindings -------------------
"" My keybindings
let mapleader="\<space>"
nnoremap <Leader>q  :q<CR>
nnoremap <Leader>w  :w<CR>
nnoremap <Leader>x  :x<CR>
nnoremap <Leader>n  :next<CR>
nnoremap <Leader>p  :prev<CR>

nnoremap <C-h>      :noh<CR>
inoremap <C-a>      <C-o>0
inoremap <C-e>      <C-o>$
nnoremap <CR><CR>   m`o<ESC>``
nnoremap ;;         m`A;<ESC>``
nnoremap ##         m`0i#<ESC>``
nnoremap ""         m`0i"<ESC>``
nnoremap //         m`0i//<ESC>``

" Toggle terminal on/off (neovim)
nnoremap <A-t> :call TermToggle(12)<CR>
inoremap <A-t> <Esc>:call TermToggle(12)<CR>
tnoremap <A-t> <C-\><C-n>:call TermToggle(12)<CR>

" Terminal go back to normal mode
tnoremap <Esc> <C-\><C-n>
tnoremap :q! <C-\><C-n>:q!<CR>

"" reMapping things
map n nzz
map N Nzz
nnoremap <UP>   g<UP>
nnoremap <DOWN> g<DOWN>

"" Plugins Bindings
map <Leader>vp  :VimuxPromptCommand<CR>
map <Leader>vl  :VimuxRunLastCommand<CR>
map <Leader>wr  :w \| VimuxRunLastCommand<CR>

nnoremap <C-p>  :Files<CR>
nnoremap <C-f>  :Ag<space>

inoremap <expr> <CR> pumvisible() ? "\<C-y>" : "\<C-g>u\<CR>"
inoremap <expr> <C-n> pumvisible() ? '<C-n>' :
            \ '<C-n><C-r>=pumvisible() ? "\<lt>Down>" : ""<CR>'
inoremap <expr> <M-,> pumvisible() ? '<C-n>' :
            \ '<C-x><C-o><C-n><C-p><C-r>=pumvisible() ? "\<lt>Down>" : ""<CR>'

" more key mappings at end of file

""" Auto Commands ------------------
augroup CursorLine
    au!
    au VimEnter,WinEnter,BufWinEnter * setlocal cursorline
    au VimEnter,WinEnter,BufWinEnter * hi cursorline gui=bold guifg=none guibg=#404747
    au WinLeave * setlocal nocursorline
augroup END

augroup VCenterCursor
  au!
  au BufEnter,WinEnter,WinNew,VimResized *,*.*
        \ let &scrolloff=winheight(win_getid())/3
augroup END

""" Plugin Management -----------
call plug#begin()

"" Plugins Installation ------------
Plug 'neoclide/coc.nvim', {'tag': '*', 'branch': 'release'}
"Plug 'Shougo/deoplete.nvim', { 'do': ':UpdateRemotePlugins' }
"Plug 'deoplete-plugins/deoplete-zsh'
"Plug 'deoplete-plugins/deoplete-jedi'
"Plug 'deoplete-plugins/deoplete-docker'
"Plug 'poppyschmo/deoplete-latex'
"Plug 'phpactor/phpactor' ,  {'do': 'composer install', 'for': 'php'}
"Plug 'kristijanhusak/deoplete-phpactor'
"Plug 'tbodt/deoplete-tabnine', { 'do': './install.sh' }
"Plug 'deathlyfrantic/deoplete-spell'
"Plug 'Shougo/neosnippet.vim'
"Plug 'shougo/neosnippet-snippets'
" Plug 'carlitux/deoplete-ternjs', { 'do': 'npm install -g tern' }
" Plug 'valloric/youcompleteme', { 'dir': '~/.config/nvim/plugged/youcompleteme','do': './install.py --java-completer' }
Plug 'scrooloose/nerdcommenter' 
Plug 'scrooloose/nerdtree' 
Plug 'tiagofumo/vim-nerdtree-syntax-highlight'
Plug 'xuyuanp/nerdtree-git-plugin'
Plug 'tyok/nerdtree-ack'
Plug 'ivalkeen/nerdtree-execute'
" Plug 'jistr/vim-nerdtree-tabs'
Plug 'pseewald/nerdtree-tagbar-combined'
Plug 'terryma/vim-multiple-cursors'
Plug 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' }
Plug 'junegunn/fzf.vim'
Plug 'sheerun/vim-polyglot'
Plug 'jiangmiao/auto-pairs'
Plug 'godlygeek/tabular'
Plug 'Yggdroot/indentLine'
Plug 'severin-lemaignan/vim-minimap'
Plug 'wellle/tmux-complete.vim'
Plug 'suan/vim-instant-markdown', {'for': 'markdown'}
Plug 'w0rp/ale'
Plug 'tpope/vim-surround'
Plug 'roxma/vim-paste-easy'
Plug 'benmills/vimux'
Plug 'tmux-plugins/vim-tmux'
Plug 'christoomey/vim-tmux-navigator'
Plug 'tmux-plugins/vim-tmux-focus-events'
Plug 'ryanoasis/vim-devicons'
Plug 'majutsushi/tagbar'
Plug 'mileszs/ack.vim'
Plug 'othree/eregex.vim'
Plug 'airblade/vim-gitgutter'
Plug 'vim-scripts/matchit.zip'
Plug 'wellle/targets.vim'
Plug 'tpope/vim-commentary'
Plug 'ervandew/supertab'
Plug 'kana/vim-arpeggio'
Plug 'lambdalisue/vim-manpager'
Plug 'majutsushi/tagbar'
Plug 'iamcco/markdown-preview.nvim', {'do': 'cd app & yarn install'}
Plug 'tpope/vim-repeat'

"" Themes ----------
Plug 'felixhummel/setcolors.vim'
Plug 'flazz/vim-colorschemes'
Plug 'bling/vim-airline'
Plug 'jacoborus/tender.vim'
Plug 'sonph/onehalf', { 'rtp': '/vim' }
Plug 'flrnprz/candid.vim'
Plug 'lifepillar/vim-solarized8'
Plug 'connorholyday/vim-snazzy'
Plug 'kaicataldo/material.vim'
call plug#end()

"" Theme Configuration ------------
colorscheme candid
let g:airline_theme='onehalfdark'

""" Plugins Configuration ----------

"" Ativa as fontes Powerline
let g:airline_powerline_fonts = 1
let g:airline#extensions#tabline#enabled = 1

"" indentLine
let g:indentLine_char = '▏'

"" ALE
let g:ale_sign_error = '✗'
let g:ale_sign_warning = '⚠'

"" Vim Tmux Navigation
let g:tmux_navigator_no_mappings = 1
nnoremap <silent> <C-Left> :TmuxNavigateLeft<CR>
nnoremap <silent> <C-Down> :TmuxNavigateDown<CR>
nnoremap <silent> <C-Up> :TmuxNavigateUp<CR>
nnoremap <silent> <C-Right> :TmuxNavigateRight<CR>
nnoremap <silent> <C-\> :TmuxNavigatePrevious<CR>

"" Vimtex
"let g:vimtex_compiler_progname = 'nvr'

"" Ack.vim
if executable('ag')
  let g:ackprg = 'ag --vimgrep'
endif

"" NerdTREE Configurations
" Mappings
map <Leader>' :NERDTreeToggle<CR>
" NERDTree Git
let g:NERDTreeIndicatorMapCustom = {
    \ "Modified"  : "✹",
    \ "Staged"    : "✚",
    \ "Untracked" : "✭",
    \ "Renamed"   : "➜",
    \ "Unmerged"  : "═",
    \ "Deleted"   : "✖",
    \ "Dirty"     : "✗",
    \ "Clean"     : "✔︎",
    \ 'Ignored'   : '☒',
    \ "Unknown"   : "?"
    \ }

"" Deoplete Configuration
" Use deoplete.
let g:deoplete#enable_at_startup = 1

"" NeoSnippet
let g:neosnippet#enable_completed_snippet = 1
" Plugin key-mappings.
" Note: It must be "imap" and "smap".  It uses <Plug> mappings.
imap <Leader><Tab>     <Plug>(neosnippet_expand_or_jump)
smap <Leader><Tab>     <Plug>(neosnippet_expand_or_jump)
xmap <Leader><Tab>     <Plug>(neosnippet_expand_target)

" SuperTab like snippets behavior.
" Note: It must be "imap" and "smap".  It uses <Plug> mappings.
"imap <expr><TAB>
" \ pumvisible() ? "\<C-n>" :
" \ neosnippet#expandable_or_jumpable() ?
" \    "\<Plug>(neosnippet_expand_or_jump)" : "\<TAB>"
smap <expr><TAB> neosnippet#expandable_or_jumpable() ?
\ "\<Plug>(neosnippet_expand_or_jump)" : "\<TAB>"

" For conceal markers.
if has('conceal')
  set conceallevel=2 concealcursor=niv
endif

"" superTAB
let g:SuperTabDefaultCompletionType = "<C-n>"

"" Tagbar
let g:tagbar_ctags_bin = "/snap/bin/universal-ctags"

"" Markdown Preview
" specify browser to open preview page
" default: ''
let g:mkdp_browser = 'opera'
" use a custom markdown style must be absolute path
let g:mkdp_markdown_css = '/home/lii/.config/nvim/plugged/markdown-preview.nvim/styles/github-markdown.css'
" use a custom highlight style must absolute path
let g:mkdp_highlight_css = ''

"" Arpeggio Key Mappings
call arpeggio#map('n','',0,'sv',':vsplit<CR>')
call arpeggio#map('n','',0,'sh',':split<CR>')
call arpeggio#map('i','',0,'jo','<C-o>o')
call arpeggio#map('i','',0,'ko','<C-o>O')
call arpeggio#map('i','',0,'JO','m`<C-o>o<ESC>``')
call arpeggio#map('i','',0,'KO','m`<C-o>O<ESC>``')

filetype plugin on
filetype indent on

""" Functions ----------------------
"" My functions
" Terminal Function
let g:term_buf = 0
let g:term_win = 0
function! TermToggle(height)
    if win_gotoid(g:term_win)
        hide
    else
        botright new
        exec "resize " . a:height
        try
            exec "buffer " . g:term_buf
        catch
            call termopen($SHELL, {"detach": 0})
            let g:term_buf = bufnr("")
            set nonumber
            set norelativenumber
            set signcolumn=no
        endtry
        startinsert!
        let g:term_win = win_getid()
    endif
endfunction
